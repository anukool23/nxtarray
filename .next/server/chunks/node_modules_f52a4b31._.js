module.exports=[76535,e=>{"use strict";var r=e.i(48633);let i=async e=>{let i=await (0,r.loadSharedConfigFiles)(e);return((...e)=>{let r={};for(let i of e)for(let[e,t]of Object.entries(i))void 0!==r[e]?Object.assign(r[e],t):r[e]=t;return r})(i.configFile,i.credentialsFile)};e.s(["parseKnownFiles",0,i],76535)},23897,32961,e=>{"use strict";var r=e.i(22734),i=e.i(54799),t=e.i(14747),s=e.i(65790);let o=e=>{let r=(0,i.createHash)("sha1").update(e).digest("hex");return(0,t.join)((0,s.getHomeDir)(),".aws","sso","cache",`${r}.json`)};e.s(["getSSOTokenFilepath",0,o],32961);let{readFile:n}=r.promises,a={},l=async e=>{if(a[e])return a[e];let r=o(e);return JSON.parse(await n(r,"utf8"))};e.s(["getSSOTokenFromFile",0,l,"tokenIntercept",0,a],23897)},41500,e=>{"use strict";e.s([],19892),e.i(19892);var r=e.i(60400),i=e.i(81355),t=e.i(92395),s=e.i(96405),o=e.i(48633);let n=e=>Object.entries(e).filter(([e])=>e.startsWith(s.IniSectionType.SSO_SESSION+o.CONFIG_PREFIX_SEPARATOR)).reduce((e,[r,i])=>({...e,[r.substring(r.indexOf(o.CONFIG_PREFIX_SEPARATOR)+1)]:i}),{});var a=e.i(7104),l=e.i(58954);let c=()=>({}),g=async(e={})=>(0,l.slurpFile)(e.configFilepath??(0,t.getConfigFilepath)()).then(a.parseIni).then(n).catch(c);var f=e.i(76535);let d=e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name);e.s(["isSsoProfile",0,d],87968);var h=e.i(90771),w=e.i(48979);class p extends w.ProviderError{name="TokenProviderError";constructor(e,r=!0){super(e,r),Object.setPrototypeOf(this,p.prototype)}}var u=e.i(23897);let S="To refresh this SSO session run 'aws sso login' with the corresponding profile.",_=async(r,i={})=>{let{SSOOIDCClient:t}=await e.A(31811);return new t(Object.assign({},i.clientConfig??{},{region:r??i.clientConfig?.region,logger:i.clientConfig?.logger??i.parentClientConfig?.logger}))},C=async(r,i,t={})=>{let{CreateTokenCommand:s}=await e.A(31811);return(await _(i,t)).send(new s({clientId:r.clientId,clientSecret:r.clientSecret,refreshToken:r.refreshToken,grantType:"refresh_token"}))},k=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new p(`Token is expired. ${S}`,!1)},m=(e,r,i=!1)=>{if(void 0===r)throw new p(`Value not present for '${e}' in SSO Token${i?". Cannot refresh":""}. ${S}`,!1)};var O=e.i(32961);let{writeFile:T}=e.i(22734).promises,v=new Date(0),y=async({ssoStartUrl:t,ssoSession:s,ssoAccountId:o,ssoRegion:n,ssoRoleName:a,ssoClient:l,clientConfig:c,parentClientConfig:d,profile:w,filepath:_,configFilepath:y,ignoreCache:x,logger:P})=>{let F,E,I="To refresh this SSO session run aws sso login with the corresponding profile.";if(s)try{let e=await ((e={})=>async({callerClientConfig:r}={})=>{let t,s={...e,parentClientConfig:{...r,...e.parentClientConfig}};s.logger?.debug("@aws-sdk/token-providers - fromSso");let o=await (0,f.parseKnownFiles)(s),n=(0,i.getProfileName)({profile:s.profile??r?.profile}),a=o[n];if(a){if(!a.sso_session)throw new p(`Profile '${n}' is missing required property 'sso_session'.`)}else throw new p(`Profile '${n}' could not be found in shared credentials file.`,!1);let l=a.sso_session,c=(await g(s))[l];if(!c)throw new p(`Sso session '${l}' could not be found in shared credentials file.`,!1);for(let e of["sso_start_url","sso_region"])if(!c[e])throw new p(`Sso session '${l}' is missing required property '${e}'.`,!1);c.sso_start_url;let d=c.sso_region;try{t=await (0,u.getSSOTokenFromFile)(l)}catch(e){throw new p(`The SSO session token associated with profile=${n} was not found or is invalid. ${S}`,!1)}m("accessToken",t.accessToken),m("expiresAt",t.expiresAt);let{accessToken:h,expiresAt:w}=t,_={token:h,expiration:new Date(w)};if(_.expiration.getTime()-Date.now()>3e5)return _;if(Date.now()-v.getTime()<3e4)return k(_),_;m("clientId",t.clientId,!0),m("clientSecret",t.clientSecret,!0),m("refreshToken",t.refreshToken,!0);try{v.setTime(Date.now());let e=await C(t,d,s);m("accessToken",e.accessToken),m("expiresIn",e.expiresIn);let r=new Date(Date.now()+1e3*e.expiresIn);try{var y;let i;await (y={...t,accessToken:e.accessToken,expiresAt:r.toISOString(),refreshToken:e.refreshToken},i=(0,O.getSSOTokenFilepath)(l),T(i,JSON.stringify(y,null,2)))}catch(e){}return{token:e.accessToken,expiration:r}}catch(e){return k(_),_}})({profile:w,filepath:_,configFilepath:y,ignoreCache:x})();F={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new r.CredentialsProviderError(e.message,{tryNextLink:!1,logger:P})}else try{F=await (0,u.getSSOTokenFromFile)(t)}catch(e){throw new r.CredentialsProviderError(`The SSO session associated with this profile is invalid. ${I}`,{tryNextLink:!1,logger:P})}if(new Date(F.expiresAt).getTime()-Date.now()<=0)throw new r.CredentialsProviderError(`The SSO session associated with this profile has expired. ${I}`,{tryNextLink:!1,logger:P});let{accessToken:N}=F,{SSOClient:$,GetRoleCredentialsCommand:A}=await e.A(72320),D=l||new $(Object.assign({},c??{},{logger:c?.logger??d?.logger,region:c?.region??n}));try{E=await D.send(new A({accountId:o,roleName:a,accessToken:N}))}catch(e){throw new r.CredentialsProviderError(e,{tryNextLink:!1,logger:P})}let{roleCredentials:{accessKeyId:j,secretAccessKey:R,sessionToken:b,expiration:L,credentialScope:G,accountId:q}={}}=E;if(!j||!R||!b||!L)throw new r.CredentialsProviderError("SSO returns an invalid temporary credential.",{tryNextLink:!1,logger:P});let K={accessKeyId:j,secretAccessKey:R,sessionToken:b,expiration:new Date(L),...G&&{credentialScope:G},...q&&{accountId:q}};return s?(0,h.setCredentialFeature)(K,"CREDENTIALS_SSO","s"):(0,h.setCredentialFeature)(K,"CREDENTIALS_SSO_LEGACY","u"),K},x=(e,i)=>{let{sso_start_url:t,sso_account_id:s,sso_region:o,sso_role_name:n}=e;if(!t||!s||!o||!n)throw new r.CredentialsProviderError(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}
Reference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:i});return e};e.s(["validateSsoProfile",0,x],62771);let P=(e={})=>async({callerClientConfig:t}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");let{ssoStartUrl:s,ssoAccountId:o,ssoRegion:n,ssoRoleName:a,ssoSession:l}=e,{ssoClient:c}=e,h=(0,i.getProfileName)({profile:e.profile??t?.profile});if(s||o||n||a||l)if(s&&o&&n&&a)return y({ssoStartUrl:s,ssoSession:l,ssoAccountId:o,ssoRegion:n,ssoRoleName:a,ssoClient:c,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:h,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger});else throw new r.CredentialsProviderError('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger});{let i=(await (0,f.parseKnownFiles)(e))[h];if(!i)throw new r.CredentialsProviderError(`Profile ${h} was not found.`,{logger:e.logger});if(!d(i))throw new r.CredentialsProviderError(`Profile ${h} is not configured with SSO credentials.`,{logger:e.logger});if(i?.sso_session){let t=(await g(e))[i.sso_session],o=` configurations in profile ${h} and sso-session ${i.sso_session}`;if(n&&n!==t.sso_region)throw new r.CredentialsProviderError("Conflicting SSO region"+o,{tryNextLink:!1,logger:e.logger});if(s&&s!==t.sso_start_url)throw new r.CredentialsProviderError("Conflicting SSO start_url"+o,{tryNextLink:!1,logger:e.logger});i.sso_region=t.sso_region,i.sso_start_url=t.sso_start_url}let{sso_start_url:t,sso_account_id:o,sso_region:a,sso_role_name:l,sso_session:w}=x(i,e.logger);return y({ssoStartUrl:t,ssoSession:w,ssoAccountId:o,ssoRegion:a,ssoRoleName:l,ssoClient:c,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:h,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger})}};e.s(["fromSSO",0,P],22558),e.i(22558),e.i(87968),e.s([],70132),e.i(70132),e.i(62771),e.s(["fromSSO",0,P,"isSsoProfile",0,d,"validateSsoProfile",0,x],41500)},31811,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_a3c692c5._.js","server/chunks/c86e0_@aws-sdk_nested-clients_dist-es_submodules_sso-oidc_index_110e81d8.js"].map(r=>e.l(r))).then(()=>r(83872)))},72320,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_a8843e92._.js","server/chunks/c86e0_@aws-sdk_1601c648._.js"].map(r=>e.l(r))).then(()=>r(68196)))}];

//# sourceMappingURL=node_modules_f52a4b31._.js.map